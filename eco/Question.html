<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ¸›å¡‘è¡Œå‹•äº’å‹•å•ç­”</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans TC", sans-serif;
      margin: 0;
      padding: 0;
      background: #e0f7fa;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: #ffffff;
      max-width: 600px;
      width: 90%;
      padding: 20px 24px;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    h1 {
      margin-top: 0;
      font-size: 1.6rem;
      text-align: center;
    }
    .intro {
      font-size: 0.95rem;
      color: #444;
      margin-bottom: 12px;
    }
    .input-row {
      margin-bottom: 16px;
    }
    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
    }
    .question-box {
      margin-top: 12px;
    }
    .question-title {
      font-size: 1.1rem;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .question-text {
      margin-bottom: 8px;
      font-size: 1rem;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .option-btn {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #00796b;
      background: #ffffff;
      cursor: pointer;
      text-align: left;
      font-size: 0.95rem;
      transition: background 0.2s, transform 0.1s;
    }
    .option-btn:hover {
      background: #e0f2f1;
      transform: translateY(-1px);
    }
    .option-selected {
      background: #00796b;
      color: #ffffff;
    }
    .actions {
      margin-top: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    button.primary {
      padding: 8px 12px;
      border-radius: 999px;
      border: none;
      background: #00796b;
      color: #ffffff;
      font-size: 0.95rem;
      cursor: pointer;
    }
    button.primary:disabled {
      background: #999999;
      cursor: not-allowed;
    }
    .progress {
      font-size: 0.85rem;
      color: #555;
    }
    .result-box {
      margin-top: 16px;
      padding: 12px;
      border-radius: 10px;
      background: #e0f2f1;
      font-size: 0.95rem;
    }
    .status {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #555;
    }
    /* é¡Œç›®æ¨™é¡Œ + ç‡ˆæ³¡æ’ç‰ˆ */
    .question-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .hint-btn {
      border: none;
      background: #fff3cd;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .hint-box {
      margin-top: 4px;
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 8px;
      background: #f1f8e9;
      font-size: 0.9rem;
      color: #333;
    }
    .hint-box ul {
      margin: 4px 0 0;
      padding-left: 20px;
    }
    .hint-box li {
      font-size: 0.9rem;
      margin-bottom: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>æ¸›å¡‘è¡Œå‹•ï½œæµ·æ´‹å®ˆè­·å°æ¸¬é©—</h1>
    <p class="intro">
      ğŸŒŸ â€œLetâ€™s take a quick quiz to find out which â€˜Development vs. Conservationâ€™ type best matches you!
         Answer based on your true thoughts.â€
      ğŸŒŸè®“æˆ‘å€‘ä¾†åšå€‹ç°¡å–®çš„å¿ƒç†æ¸¬é©—å§ï¼çœ‹çœ‹ä½ æ˜¯å“ªç¨®ã€Œç™¼å±•èˆ‡ä¿è‚²ã€é¡å‹ï¼
        è«‹ä¾ç…§ä½ çš„çœŸå¯¦æƒ³æ³•ä½œç­”å”·ï¼
    </p>

    <div class="input-row">
      <label for="userName">æš±ç¨± / åº§è™Ÿï¼ˆå¯é¸å¡«ï¼‰</label>
      <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼š3 è™Ÿå°æ˜ã€Lilyâ€¦" />
    </div>

    <div id="quizArea">
      <!-- é¡Œç›®æœƒç”¨ JS å‹•æ…‹å¡é€²ä¾† -->
    </div>

    <div class="actions">
      <div class="progress" id="progressText">ç¬¬ 1 / 5 é¡Œ</div>
      <button class="primary" id="nextBtn" disabled>ä¸‹ä¸€é¡Œ</button>
    </div>

    <div class="result-box" id="resultBox" style="display:none;"></div>
    <div class="status" id="statusText"></div>
  </div>

  <script>
    // GAS Web App URL
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxC-OG6rbAwSCzoQESEiQeLpLyI39_nh54McjWfhSC0Z5O9brTUXMvwaqxk32q7CrVT/exec";

    // çµæœåœ–ç‰‡
    const RESULT_IMAGE_URLS = {
      1: "https://drive.google.com/thumbnail?id=1OtZ43YsvsRGHhjAiKqcWsG7YpaoU6bVu&sz=w1000", // çµæœä¸€
      2: "https://drive.google.com/thumbnail?id=1GARMGL7Cm1fV3RsQbUHB4eRca-bDLZ0J&sz=w1000", // çµæœäºŒ
      3: "https://drive.google.com/thumbnail?id=1IQUBchBbZpV8d3kMyr_R4F_xlVLpSKmK&sz=w1000"  // çµæœä¸‰
    };

    // é¡Œç›®è¨­å®šï¼štextA è‹±æ–‡ï¼ˆA èªè¨€ï¼‰ã€textB ä¸­æ–‡ï¼ˆB èªè¨€ï¼‰
    // é¸é …ï¼štextA è‹±æ–‡ã€textB ä¸­æ–‡
    const questions = [
      {
        textA: "How do you want the local economy to develop?",
        textB: "ä½ å¸Œæœ›ç’°å¢ƒçš„ç¶“æ¿Ÿç™¼å±•å¦‚ä½•ï¼Ÿ",
        options: [
          {
            textA: "Make as much money as possible, prioritizing business.",
            textB: "è¶Šè³ºéŒ¢è¶Šå¥½ï¼Œå•†æ¥­æ´»å‹•å„ªå…ˆ",
            value: 1
          },
          {
            textA: "It doesnâ€™t have to earn that much, as long as the environment stays clean.",
            textB: "ä¸ç”¨å¤ªè³ºéŒ¢ï¼Œä½†ç’°å¢ƒè¦ä¿æŒä¹¾æ·¨",
            value: 0
          }
        ]
      },
      {
        textA: "If a very profitable mall could be built by the sea, what would you prefer?",
        textB: "å¦‚æœæµ·é‚Šèƒ½è“‹ä¸€å€‹å¾ˆè³ºéŒ¢çš„å•†å ´ï¼Œä½ æœƒå¸Œæœ›ï¼Ÿ",
        options: [
          {
            textA: "Build it! Earning money is the most important.",
            textB: "è“‹ï¼æœ‰è³ºéŒ¢æœ€é‡è¦",
            value: 1
          },
          {
            textA: "Donâ€™t build it. Keeping marine animals safe matters more.",
            textB: "å…ˆä¸è¦ï¼Œè®“æµ·æ´‹å‹•ç‰©å®‰å…¨æ¯”è¼ƒé‡è¦",
            value: 0
          }
        ]
      },
      {
        textA: "You are buying a drink. The shop asks: sealed plastic cup or your own tumbler?",
        textB: "ä½ ä»Šå¤©è²·é£²æ–™ï¼Œåº—å®¶å•ä½ å°è†œæˆ–è‡ªå¸¶æ¯ï¼Œä½ æœƒé¸ï¼Ÿ",
        options: [
          {
            textA: "A sealed plastic cup. Itâ€™s the fastest and most convenient.",
            textB: "å°è†œæœ€å¿«ã€æœ€æ–¹ä¾¿",
            value: 1
          },
          {
            textA: "My own tumbler, so I donâ€™t create extra trash.",
            textB: "è‡ªå¸¶æ¯æ¯”è¼ƒä¸æœƒè£½é€ åƒåœ¾",
            value: 0
          }
        ]
      },
      {
        textA: "For a class field trip, which transportation would you choose?",
        textB: "ç­ç´šæˆ¶å¤–æ•™å­¸è¦é¸äº¤é€šå·¥å…·ï¼Œä½ åå¥½ï¼Ÿ",
        options: [
          {
            textA: "Tour bus. Itâ€™s the least tiring and saves time.",
            textB: "éŠè¦½è»Šï¼Œæœ€ä¸ç´¯æœ€çœæ™‚",
            value: 1
          },
          {
            textA: "Walking or MRT, to reduce pollution and emissions.",
            textB: "æ­¥è¡Œæˆ–æ·é‹ï¼Œæ¸›å°‘æ’æ”¾æ¯”è¼ƒå¥½",
            value: 0
          }
        ]
      },
      {
        textA: "If you find a plastic bag that can still be used, what would you do?",
        textB: "å¦‚æœä½ æ’¿åˆ°ä¸€å€‹é‚„èƒ½ç”¨çš„å¡‘è† è¢‹ï¼Œä½ æœƒï¼Ÿ",
        options: [
          {
            textA: "Throw it away. Itâ€™s cheap anyway.",
            textB: "ä¸Ÿæ‰ï¼Œåæ­£å¾ˆä¾¿å®œ",
            value: 1
          },
          {
            textA: "Keep it and reuse it.",
            textB: "ç•™ä¸‹ä¾†é‡è¤‡ä½¿ç”¨",
            value: 0
          }
        ]
      }
    ];

    let currentIndex = 0;
    let answers = []; // ç´€éŒ„ 0/1
    let selectedValue = null;
    let startTime = Date.now();
    const sessionId = "sess_" + Math.random().toString(36).slice(2);

    const quizArea = document.getElementById("quizArea");
    const progressText = document.getElementById("progressText");
    const nextBtn = document.getElementById("nextBtn");
    const resultBox = document.getElementById("resultBox");
    const statusText = document.getElementById("statusText");
    const userNameInput = document.getElementById("userName");

    function renderQuestion() {
      const q = questions[currentIndex];
      quizArea.innerHTML = "";

      const qBox = document.createElement("div");
      qBox.className = "question-box";

      // æ¨™é¡Œ + ç‡ˆæ³¡
      const header = document.createElement("div");
      header.className = "question-header";

      const title = document.createElement("div");
      title.className = "question-title";
      title.textContent = "ç¬¬ " + (currentIndex + 1) + " é¡Œ";

      const hintBtn = document.createElement("button");
      hintBtn.type = "button";
      hintBtn.className = "hint-btn";
      hintBtn.innerHTML = "ğŸ’¡";

      header.appendChild(title);
      header.appendChild(hintBtn);

      const qText = document.createElement("div");
      qText.className = "question-text";
      // é¡Œç›®ä¸»é¡¯ç¤ºè‹±æ–‡
      qText.textContent = q.textA;

      const hintBox = document.createElement("div");
      hintBox.className = "hint-box";
      hintBox.style.display = "none";

      // ä¸­æ–‡é¡Œç›® + ä¸­æ–‡é¸é …åˆ—è¡¨
      const hintQuestion = document.createElement("div");
      hintQuestion.textContent = q.textB;

      const hintList = document.createElement("ul");
      q.options.forEach((opt, idx) => {
        const li = document.createElement("li");
        li.textContent = (idx === 0 ? "A. " : "B. ") + opt.textB;
        hintList.appendChild(li);
      });

      hintBox.appendChild(hintQuestion);
      hintBox.appendChild(hintList);

      hintBtn.addEventListener("click", () => {
        hintBox.style.display = (hintBox.style.display === "none") ? "block" : "none";
      });

      const optionsDiv = document.createElement("div");
      optionsDiv.className = "options";

      q.options.forEach((opt) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        // é¸é …æŒ‰éˆ•ä¸»é¡¯ç¤ºè‹±æ–‡
        btn.textContent = opt.textA;
        btn.addEventListener("click", () => {
          selectedValue = opt.value;
          // UI æ¨™è¨˜è¢«é¸ä¸­
          Array.from(optionsDiv.children).forEach(c => c.classList.remove("option-selected"));
          btn.classList.add("option-selected");
          nextBtn.disabled = false;
        });
        optionsDiv.appendChild(btn);
      });

      qBox.appendChild(header);
      qBox.appendChild(qText);
      qBox.appendChild(hintBox);
      qBox.appendChild(optionsDiv);
      quizArea.appendChild(qBox);

      progressText.textContent = "ç¬¬ " + (currentIndex + 1) + " / " + questions.length + " é¡Œ";
      nextBtn.textContent = currentIndex === questions.length - 1 ? "çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ";
      nextBtn.disabled = true;
      selectedValue = null;
      resultBox.style.display = "none";
      statusText.textContent = "";
    }

    function calcType(answers) {
      // answers æ˜¯ 0/1ï¼Œçµ±è¨ˆé¸ 1 çš„æ¬¡æ•¸
      const count1 = answers.filter(v => v === 1).length;
      let type, desc;
      if (count1 >= 4) {
        type = 1;
        desc = "ä½ åå‘ã€Œé«˜ç¶“æ¿Ÿç™¼å±•ï¼Œç”Ÿç‰©é€æ¼¸å—å®³ã€é¡å‹ï¼Œé‡è¦–æ–¹ä¾¿èˆ‡è³ºéŒ¢ï¼Œå°æ¸›å¡‘èˆ‡ä¿è‚²çš„è¦æ±‚è¼ƒä½ã€‚";
      } else if (count1 >= 2) {
        type = 2;
        desc = "ä½ åå‘ã€Œå¶çˆ¾ç’°ä¿ï¼Œæ…‹åº¦ä¸­é–“ã€é¡å‹ï¼Œæœ‰æ™‚æœƒç‚ºç’°å¢ƒåšé¸æ“‡ï¼Œä½†ä¹Ÿå¸¸ç‚ºäº†æ–¹ä¾¿è€Œå¦¥å”ã€‚";
      } else {
        type = 3;
        desc = "ä½ åå‘ã€Œä½ç™¼å±•ä½†ç”Ÿç‰©ä¿è‚²å„ªè‰¯ã€é¡å‹ï¼Œé¡˜æ„ç‚ºæµ·æ´‹ç”Ÿç‰©èˆ‡ç’°å¢ƒå“è³ªåšå‡ºå–æ¨ã€‚";
      }
      return { type, desc, count1 };
    }

    async function submitToGAS(result) {
      const timeUsedMs = Date.now() - startTime;
      const payload = {
        sessionId: sessionId,
        userName: userNameInput.value || "",
        answers: answers,     // ä¾‹å¦‚ [1,0,1,0,1]
        type: result.type,    // 1 / 2 / 3
        timeUsedMs: timeUsedMs
      };

      statusText.textContent = "è³‡æ–™ä¸Šå‚³ä¸­â€¦";

      try {
        const res = await fetch(GAS_URL, {
          method: "POST",
          headers: {
            "Content-Type": "text/plain" // ç”¨ text/plain é¿å… CORS preflight å•é¡Œ
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (data.status === "ok") {
          statusText.textContent = "âœ… ä½œç­”ç´€éŒ„å·²é€å‡ºã€‚";
        } else {
          statusText.textContent = "âš ï¸ ä¸Šå‚³å¤±æ•—ï¼ˆä½†ä½ çš„çµæœå·²åœ¨é€™å€‹é é¢é¡¯ç¤ºï¼‰ã€‚";
        }
      } catch (err) {
        console.error(err);
        statusText.textContent = "âš ï¸ ä¸Šå‚³æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼ˆä½†ä½ çš„çµæœå·²åœ¨é€™å€‹é é¢é¡¯ç¤ºï¼‰ã€‚";
      }
    }

    function showResult() {
      const result = calcType(answers);
      const imgUrl = RESULT_IMAGE_URLS[result.type];

      let imgHtml = "";
      if (imgUrl) {
        imgHtml = `
          <div style="margin-top:8px; text-align:center;">
            <img src="${imgUrl}" alt="çµæœ${result.type} åœ–ç‰‡"
                 style="max-width:100%; border-radius:12px;"/>
          </div>
        `;
      }

      resultBox.style.display = "block";
      resultBox.innerHTML = `
        <div><strong>ä½ çš„é¡å‹ï¼šç¬¬ ${result.type} é¡</strong></div>
        <div style="margin-top:6px;">${result.desc}</div>
        ${imgHtml}
      `;

      // é€åˆ° GAS
      submitToGAS(result);
    }

    nextBtn.addEventListener("click", () => {
      if (selectedValue === null) return;
      answers[currentIndex] = selectedValue;

      if (currentIndex < questions.length - 1) {
        currentIndex++;
        renderQuestion();
      } else {
        // å®Œæˆæ‰€æœ‰é¡Œç›®
        quizArea.innerHTML = "";
        progressText.textContent = "å·²å®Œæˆæ‰€æœ‰é¡Œç›®";
        nextBtn.disabled = true;
        showResult();
      }
    });

    // åˆå§‹åŒ–
    renderQuestion();
  </script>
</body>
</html>
